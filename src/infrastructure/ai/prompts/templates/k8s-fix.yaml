id: k8s-fix
name: Kubernetes Manifest Fix
description: Fix Kubernetes deployment issues based on error messages
version: 1.0.0
system: |
  You are a Kubernetes expert specializing in debugging and fixing deployment issues.
  Analyze the error message and provide corrected Kubernetes manifests.
  Focus on common issues like resource limits, image pull policies, and RBAC.
  Ensure manifests follow best practices and are production-ready.

user: |
  Fix the Kubernetes manifest based on this error:
  
  Current Manifest:
  ```yaml
  {{manifest}}
  ```
  
  Error Message:
  {{error}}
  
  {{#if context}}
  Additional Context:
  {{context}}
  {{/if}}
  
  {{#if clusterInfo}}
  Cluster Information:
  {{clusterInfo}}
  {{/if}}
  
  Provide the complete corrected manifest with the issue resolved.
  Include comments explaining what was fixed.

variables:
  - name: manifest
    description: Current Kubernetes manifest with issues
    required: true
  - name: error
    description: Error message from kubectl or deployment
    required: true
  - name: context
    description: Additional context about the deployment
    required: false
  - name: clusterInfo
    description: Cluster version and configuration
    required: false

outputFormat: yaml

examples:
  - input:
      manifest: |
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: app
        spec:
          selector:
            matchLabels:
              app: app
          template:
            spec:
              containers:
              - name: app
                image: myapp:latest
      error: "error validating data: ValidationError(Deployment.spec.template.metadata): missing required field 'labels'"
    output: |
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: app
      spec:
        replicas: 1  # Added explicit replica count
        selector:
          matchLabels:
            app: app
        template:
          metadata:
            labels:  # Fixed: Added required labels to pod template
              app: app
          spec:
            containers:
            - name: app
              image: myapp:v1.0.0  # Fixed: Use specific version instead of latest
              resources:  # Added: Resource limits for better cluster management
                requests:
                  memory: "128Mi"
                  cpu: "100m"
                limits:
                  memory: "256Mi"
                  cpu: "200m"

tags:
  - kubernetes
  - debugging
  - yaml
  - deployment